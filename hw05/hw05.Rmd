---
title: "hw05"
author: "Xinzhe Dong"
date: "October 12, 2017"
output: github_document
---

### Abstract

We are going to explore the gapminder data set. We will be practicing data reshaping and join.

#### Table of content
-   [Load data and packages](#load-data-and-packages)
-   [Factor management](#factor-management)
-   [File I/O](#file-io)
-   [Visualization design](#visualization-design)
-   [Writing figures to file](#writing-figures-to-file)
-   [But I want to do more!](#but-i-want-to-do-more)



Load data and packages
----------------------

[*Back to the top*](#abstract)

```{r}
library(gapminder)
library(tidyverse)
library(knitr)
library(kableExtra)
library(ggplot2)
library(forcats)
library(pander)
library(RColorBrewer)

```


Factor management
-----------------

[*Back to the top*](#abstract)

Get to know your factor before you start touching it!
```{r}
fct_count(gapminder$continent)
```

Drop all the rows corresponding to "Oceania".
```{r}
h_gap <- gapminder %>%
  filter(continent != "Oceania")

fct_count(h_gap$continent)
nlevels(h_gap$continent)
```
We dropped 24 rows associated with "Oceania". However, the levels of the continent factor itself do not change. "Oceania" is still a level of "continent".

Dropping "Oceania" level.
```{r}
h_gap_dropped <- h_gap %>% 
  droplevels()
fct_count(h_gap_dropped$continent)
nlevels(h_gap_dropped$continent)
```
Now, we dropped 24 rows associated with "Oceania". Additionally, we also dropped the level "Oceania" of the factor "continent".


Change order of the levels

Reorder Gapminder continents by lifeExp
```{r}
## order continent according to minimum life exp
fct_reorder(h_gap_dropped$continent, h_gap_dropped$lifeExp, min) %>% 
  levels() %>% head()

h_gap_dropped$continent<-fct_reorder(h_gap_dropped$continent, h_gap_dropped$lifeExp, min)

h_gap_dropped%>%
  group_by(continent)%>%
  summarise(min(lifeExp))%>%
  kable()
```

Common part:
**While you’re here, practice writing to file and reading back in (see next section).**


**Characterize the (derived) data before and after your factor re-leveling.**

Explore the effects of arrange().

```{r}
gap_asia_2007 <- gapminder %>% filter(year == 2007, continent == "Asia")
# unarranged, reordered
ggplot(gap_asia_2007, aes(x = lifeExp, y = country)) + geom_point() +
        labs(title= "Plot of lifeExp of countries in Asian in 2007") 

# arranged
gap_asia_2007%>%
  arrange(country, lifeExp)%>%
    ggplot(aes(x = lifeExp, y = country)) + geom_point() +
        labs(title= "Plot of lifeExp of countries(arranged) in Asian in 2007") 

# reordered
ggplot(gap_asia_2007, aes(x = lifeExp, y = fct_reorder(country, lifeExp, min))) +
  geom_point() + labs(title= "Plot of lifeExp of countries(reordered) in Asian in 2007") 


# first reordered, then arranged
gap_asia_2007%>%
  mutate(country=fct_reorder(country, lifeExp, min))%>%
  arrange(country, lifeExp)%>%
    ggplot(aes(x = lifeExp, y = country)) + geom_point() +
        labs(title= "Plot of lifeExp of countries(reordered, arranged) in Asian in 2007") 
```

**Note**: 

* Merely arranging the data has no effect on a figure.
* Reordered factor levels makes plots much better.


File I/O
--------

[*Back to the top*](#abstract)


```{r}
write_csv(h_gap_dropped, "h_gap_dropped.csv")
h_gap_dropped_csv<-read_csv("h_gap_dropped.csv")

h_gap_dropped_csv%>%
  group_by(continent)%>%
  summarise(min(lifeExp))%>%
  kable()
```

We can tell that the order of continents changed. We ordered continent according to minimum life expectancy in the previous section. However, after `write_csv()`/`read_csv()`, the levels of the factor continent again become alphabetically ordered.

```{r}
saveRDS(h_gap_dropped, "h_gap_dropped2.csv")
h_gap_dropped_csv2<-readRDS("h_gap_dropped2.csv")

h_gap_dropped_csv2%>%
  group_by(continent)%>%
  summarise(min(lifeExp))%>%
  kable()

```

`saveRDS()` and `readRDS()` preserve our work before! The reordered levels are preserved.


Visualization design
--------------------

[*Back to the top*](#abstract)


Remake at least one figure or create a new one, in light of something you learned in the recent class meetings about visualization design and color. Maybe juxtapose your first attempt and what you obtained after some time spent working on it. Reflect on the differences. If using Gapminder, you can use the country or continent color scheme that ships with Gapminder.

```{r}
# a plot from my hw02
p1<- ggplot(gapminder, aes(x = lifeExp, color = continent)) + geom_density()

p2<- ggplot(gapminder, aes(x = lifeExp, color = continent)) + geom_density() +
      facet_wrap(~ continent) +
      scale_color_manual(values=brewer.pal(n=5, "Dark2")) +
      labs(title= "Density plot of lifeExp on different continents") +
  
  theme_bw() +
  theme(strip.background = element_rect(fill="orange"),
          axis.title = element_text(size=14,face="bold"),
          strip.text = element_text(size=14, face="bold"))

# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  require(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}


multiplot(p1, p2, cols = 1)

```

Writing figures to file
-----------------------

[*Back to the top*](#abstract)

Use ggsave() to explicitly save a plot to file.
```{r}
ggsave(filename="Density plot of lifeExp on different continents",
       plot=p2,device =  "png",width = 8, height = 8)

```

**Note**: Explicit provision of the plot object p is not necessary since p2 is the last plot we have. And thie is the only plot we will save to file.

Now we try to load the plot we just saved to file.

![Density plot of lifeExp on different continents](/Users/hannahdong/Desktop/Stat545/STAT545-hw-Dong-Xinzhe/hw05/Plot\ of\ life\ expectancy\ over\ time\ on\ different\ continents)


But I want to do more!
----------------------

Pick a handful of countries, each of which you can associate with a stereotypical food (or any other non-controversial thing … sport? hobby? type of music, art or dance? animal? landscape feature?). Create an excerpt of the Gapminder data, filtered to just these countries. 

Create a new factor – you pick the name! – by mapping the existing country factor levels to the new levels.
Examples: Italy –> wine, Germany –> beer, Japan –> sake. (Austria, Germany) –> German, (Mexico, Spain) –> Spanish, (Portugal, Brazil) –> Portuguese. Let your creativity flourish.
```{r}
filter_country <- filter(gapminder, country%in% c("Canada","China","United States"))
filter_country

sport <- c("hockey","table tennis","basketball")

# fct_recode(filter_country$country, sport) %>% levels()



```

[*Back to the top*](#abstract)


